
buildDir = "Build/$(configuration)/.$(target)"

version = "0.1"

examples = "Examples/*/umdoc.xml"
examples = "$(patsubst Examples/%/umdoc.xml,%,$(examples))"

targets = {

  all = {
    dependencies = { "umdoc", "manual", "$(examples)" }
  }

  umdoc = cppApplication + {
    dependencies = { "libnstd" }
    outputDir = "Build/$(configuration)"
    includePaths = { "Ext/libnstd/include" }
    libPaths = { "Build/$(configuration)/.libnstd" }
    libs = { "nstd" }
    defines = { "VERSION=\"$(version)\"" }
    root = "Src"
    files = {
      "Src/*.cpp" = cppSource
      "Src/*.h"
    }
    if tool == "vcxproj" {
      linkFlags += { "/SUBSYSTEM:CONSOLE" }
    }
    if platform == "Linux" {
      libs += { "pthread", "rt" }
      cppFlags += { "-Wno-delete-non-virtual-dtor" }
    }
  }
  
  manual = {
    dependencies = { "umdoc" }
    outputDir = "Build/$(configuration)"
    root = "Doc"
    files = { "Doc/*" }    
    input = files
    output = "$(outputDir)/umdoc.pdf"
    command = "Build/$(configuration)/umdoc Doc/umdoc.xml -o $(output) -a $(buildDir)"
  }
  
  "$(examples)" = {
    folder = "Examples"
    dependencies = { "umdoc" }
    outputDir = "Build/$(configuration)/Examples"
    root = "Examples/$(target)"
    files = { "Examples/$(target)/*" }  
    input = files
    output = "$(outputDir)/$(target).pdf"
    command = "Build/$(configuration)/umdoc Examples/$(target)/umdoc.xml -o $(output) -a $(buildDir)"
  }

  include "Ext/libnstd/libnstd.mare"
  libnstd += {
    folder = "Ext"
    enableDocument = "true"
  }
}
